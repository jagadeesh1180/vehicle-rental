<!DOCTYPE html>
<html>
<head>
  <title>Confirm Booking</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet">

  <style>
    body {
      background: #000;
      color: #fff;
      font-family: "Segoe UI", sans-serif;
    }

    .card {
      background: #111;
      border: 1px solid #333;
      border-radius: 14px;
    }

    .form-control {
      background: #000;
      color: #fff;
      border: 1px solid #444;
    }

    .form-control:read-only {
      background: #111;
      color: #aaa;
    }

    .btn-primary {
      background: #fff;
      color: #000;
      font-weight: 600;
      border: none;
    }
  </style>
</head>

<body>

<!-- USER PROTECTION -->
<script>
if (!sessionStorage.getItem("selectedVehicle")) {
  window.location.href = "map.html";
}
</script>

<div class="container d-flex justify-content-center align-items-center" style="height:100vh;">
  <div class="card p-4 shadow-lg w-100" style="max-width:420px;">


    <h4 class="text-center mb-3">Confirm Booking</h4>

    <div class="mb-3">
      <label class="form-label">Vehicle</label>
      <input id="vehicle" class="form-control" readonly>
    </div>

    <div class="mb-3">
      <label class="form-label">Price per Hour</label>
      <input id="price" class="form-control" readonly>
    </div>

    <div class="mb-3">
      <label class="form-label">Number of Hours</label>
      <input
        id="hours"
        type="number"
        min="1"
        value="1"
        class="form-control">
    </div>

    <div class="mb-3">
      <label class="form-label">Total Amount</label>
      <input id="total" class="form-control" readonly>
    </div>

    <button class="btn btn-primary w-100" onclick="confirmBooking()">
      Confirm & Book
    </button>

    <p id="result" class="text-success text-center mt-3"></p>

  </div>
</div>
<div class="mb-3">
  <label class="form-label">Payment Method</label>

  <div class="form-check">
    <input class="form-check-input" type="radio" name="payment"
      id="payOnline" value="online" checked>
    <label class="form-check-label" for="payOnline">
      Pay Online (UPI / Card)
    </label>
  </div>

  <div class="form-check">
    <input class="form-check-input" type="radio" name="payment"
      id="payCash" value="cash">
    <label class="form-check-label" for="payCash">
      Pay on Site (Cash)
    </label>
  </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <a href="map.html">üìç Map</a>
  <a href="user.html" class="active">üöú Book</a>
  <a href="index.html">üè† Home</a>
</div>


<script>
const vehicle = sessionStorage.getItem("selectedVehicle");
const price = Number(sessionStorage.getItem("selectedPrice"));

document.getElementById("vehicle").value = vehicle;
document.getElementById("price").value = "‚Çπ" + price;

function updateTotal() {
  const hours = Number(document.getElementById("hours").value);
  document.getElementById("total").value = "‚Çπ" + (hours * price);
}

document.getElementById("hours").addEventListener("input", updateTotal);
updateTotal();

function confirmBooking() {
  const hours = Number(document.getElementById("hours").value);
  const paymentMethod =
    document.querySelector('input[name="payment"]:checked').value;

  const totalAmount = hours * price;

  if (paymentMethod === "cash") {
    // Direct booking
    saveBooking("cash");
    return;
  }

  // Razorpay Test Payment
  const options = {
    key: "rzp_test_RyxFepgcVzqUKT", // TEST KEY (replace later)
    amount: totalAmount * 100,
    currency: "INR",
    name: "Vehicle Rental",
    description: vehicle + " booking",
    handler: function (response) {
      saveBooking("online", response.razorpay_payment_id);
    },
    theme: {
      color: "#0d6efd"
    }
  };
  function saveBooking(method, paymentId = null) {
  fetch("/book", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: sessionStorage.getItem("userPhone") || "User",
      vehicle,
      hours: Number(document.getElementById("hours").value),
      payment_method: method,
      payment_id: paymentId
    })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("result").innerText =
      "Booking confirmed! Total: ‚Çπ" + data.total;
  });
}


  const rzp = new Razorpay(options);
  rzp.open();
}

 

</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


</body>
</html>
